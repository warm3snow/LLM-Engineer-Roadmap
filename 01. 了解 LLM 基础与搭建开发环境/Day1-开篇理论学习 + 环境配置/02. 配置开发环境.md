# é…ç½®å¼€å‘ç¯å¢ƒï¼šå®‰è£… Python å’Œ PyTorch åº“

æœ¬æ–‡å°†é€æ­¥æŒ‡å¯¼æ‚¨é…ç½®ä¸€ä¸ªè¿›è¡Œ è‡ªç„¶è¯­è¨€å¤„ç† (NLP) å¼€å‘çš„ç¯å¢ƒï¼Œé‡ç‚¹å®‰è£… Python å’Œ PyTorch åº“ã€‚å¹¶é€šè¿‡ç®€å•çš„ä»£ç ç¤ºä¾‹å¯¹æ¯” RNN å’Œ Transformer æ¨¡å‹çš„åŸºæœ¬æ¦‚å¿µå’Œå®ç°ã€‚

## 1. å®‰è£… Python

ç¡®ä¿æ‚¨å·²å®‰è£… Python 3.7 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚å¦‚æœå°šæœªå®‰è£…ï¼Œå¯æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

**é€šç”¨æ­¥éª¤**

* **ä¸‹è½½**ï¼šå‰å¾€ [Python çš„å®˜ç½‘](https://www.python.org/downloads/) ä¸‹è½½é€‚åˆæ‚¨æ“ä½œç³»ç»Ÿçš„å®‰è£…åŒ…ã€‚
* **å®‰è£…**ï¼šè¿è¡Œå®‰è£…ç¨‹åºï¼Œç¡®ä¿ **å‹¾é€‰ "Add Python to PATH" é€‰é¡¹**ã€‚
* **éªŒè¯å®‰è£…**ï¼šå®Œæˆå®‰è£…åï¼Œæ‰“å¼€ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

  ```bash
  python3 --version
  # æˆ–
  python --version
  ```

  å¦‚æœæ˜¾ç¤º Python çš„ç‰ˆæœ¬å·ï¼ˆå¦‚ Python 3.9.7ï¼‰ï¼Œåˆ™å®‰è£…æˆåŠŸã€‚

## 2. å®‰è£… PyTorch åº“

PyTorch æ˜¯ä¸€ä¸ªæµè¡Œçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œå¹¿æ³›åº”ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ã€è®¡ç®—æœºè§†è§‰ç­‰é¢†åŸŸã€‚æˆ‘ä»¬å°†ä½¿ç”¨ pip æ¥å®‰è£… PyTorch åº“ã€‚

**å®‰è£…æ­¥éª¤**

* **æ›´æ–° pipï¼ˆæ¨èï¼‰ï¼š**

    pip æ˜¯ Python çš„åŒ…ç®¡ç†å·¥å…·ï¼Œç¡®ä¿æ‚¨ä½¿ç”¨çš„æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼š

  ```bash
  pip install --upgrade pip
  ```

* **å®‰è£… PyTorchï¼ˆæ¨èï¼‰ï¼š**

    PyTorch æ˜¯ä¸€ä¸ªæµè¡Œçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ŒTorchvision å’Œ torchaudio æ˜¯ PyTorch çš„é™„åŠ åº“ï¼Œåˆ†åˆ«ç”¨äºè®¡ç®—æœºè§†è§‰å’ŒéŸ³é¢‘å¤„ç†ã€‚

  ```bash
  pip install torch torchvision torchaudio
  ```
* **å¯é€‰å®‰è£… TensorFlowï¼ˆå¦‚éœ€è¦ä¸ TensorFlow é›†æˆï¼‰ï¼š**
    TensorFlow æ˜¯å¦ä¸€ä¸ªæµè¡Œçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ã€‚ä¸PyTorchåŠŸèƒ½ç±»ä¼¼ï¼Œä¸»è¦åŒºåˆ«åœ¨äºæ¡†æ¶çš„è®¾è®¡ç†å¿µå’Œä½¿ç”¨æ–¹å¼ã€‚

  ```bash
  pip install tensorflow
  ```

**éªŒè¯å®‰è£…**

æ‰“å¼€ Python è§£é‡Šå™¨ï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š

```python
import torch
print(torch.__version__)
```
å¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œå¹¶ä¸”è¾“å‡ºäº†ç‰ˆæœ¬å·ï¼ˆå¦‚ 1.10.0ï¼‰ï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚

```python
import tensorflow as tf
print(tf.__version__)
```
å¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œå¹¶ä¸”è¾“å‡ºäº†ç‰ˆæœ¬å·ï¼ˆå¦‚ 2.6.0ï¼‰ï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚


## 3. æ¨¡å‹ç¤ºä¾‹å¯¹æ¯”ï¼šRNN vs Transformer

æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä»£ç ç¤ºä¾‹æ„å»ºåŸºç¡€çš„ RNN å’Œ Transformer æ¨¡å‹ï¼Œå¹¶å¯¹æ¯”å…¶æ ¸å¿ƒæœºåˆ¶å’Œåº”ç”¨åœºæ™¯ã€‚

### 3.1 RNN ç¤ºä¾‹ä»£ç 

RNN æ˜¯ä¸€ç§å¾ªç¯ç¥ç»ç½‘ç»œï¼Œé€šè¿‡é€æ—¶é—´æ­¥åœ°å¤„ç†åºåˆ—æ•°æ®ï¼Œä¾èµ–å‰ä¸€æ­¥è¾“å‡ºæ¥é¢„æµ‹å½“å‰æ—¶é—´æ­¥çš„è¾“å‡ºã€‚

ä»£ç ç¤ºä¾‹ï¼š
```python
import torch
import torch.nn as nn

# å®šä¹‰ RNN æ¨¡å‹
class RNNModel(nn.Module):
    def __init__(self, input_dim, hidden_dim, output_dim):
        """
        åˆå§‹åŒ– RNN æ¨¡å‹

        å‚æ•°:
        input_dim (int): æ¯ä¸ªæ—¶é—´æ­¥çš„è¾“å…¥ç‰¹å¾ç»´åº¦
        hidden_dim (int): éšå±‚ç»´åº¦
        output_dim (int): è¾“å‡ºç»´åº¦ï¼ˆå¦‚å›å½’ä»»åŠ¡ï¼‰
        """
        super(RNNModel, self).__init__()
        self.rnn = nn.RNN(input_dim, hidden_dim, batch_first=True)
        self.fc = nn.Linear(hidden_dim, output_dim)

    def forward(self, x):
        """
        å‰å‘ä¼ æ’­å‡½æ•°

        å‚æ•°:
        x (torch.Tensor): è¾“å…¥å¼ é‡ï¼Œå½¢çŠ¶ä¸º (batch_size, seq_len, input_dim)

        è¿”å›:
        torch.Tensor: è¾“å‡ºå¼ é‡ï¼Œå½¢çŠ¶ä¸º (batch_size, output_dim)
        """
        out, _ = self.rnn(x)  # (batch_size, seq_len, hidden_dim)
        out = self.fc(out[:, -1, :])  # æå–æœ€åä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å‡º
        return out

# æ¨¡å‹å‚æ•°
input_dim = 10  # æ¯ä¸ªæ—¶é—´æ­¥çš„è¾“å…¥ç‰¹å¾ç»´åº¦
hidden_dim = 20  # éšå±‚ç»´åº¦
output_dim = 1  # è¾“å‡ºç»´åº¦ï¼ˆå¦‚å›å½’ä»»åŠ¡ï¼‰

# æ„å»ºæ¨¡å‹
model = RNNModel(input_dim=input_dim, hidden_dim=hidden_dim, output_dim=output_dim)

# ç¤ºä¾‹è¾“å…¥ï¼šbatch_size=32, seq_len=5
# 32ä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬æœ‰5ä¸ªæ—¶é—´æ­¥ï¼Œæ¯ä¸ªæ—¶é—´æ­¥æœ‰10ä¸ªç‰¹å¾
x = torch.randn(32, 5, input_dim)

# model(x)  # å‰å‘ä¼ æ’­
# è¿è¡Œæ¨¡å‹
output = model(x)

# æ³¨æ„ï¼šRNN çš„è¾“å…¥å½¢çŠ¶ä¸º (batch_size, seq_len, input_dim)
# è¾“å‡ºå½¢çŠ¶ä¸º (batch_size, output_dim)
print("RNN è¾“å‡ºç»´åº¦:", output.shape)  # (batch_size, output_dim)
```

**RNN æ•°æ®æµå›¾è§£ï¼š**

```
è¾“å…¥åºåˆ—ï¼ˆé€æ—¶é—´æ­¥ï¼‰: x(t)
      â†“
+---------------+
|    RNN å•å…ƒ    | â†â€”â€” h(t-1)  (éšè—çŠ¶æ€å¾ªç¯)
+---------------+
      â†“
  è¾“å‡ºåºåˆ— y(t)
```

**ä¼˜ç‚¹ï¼š**

- èƒ½å¤Ÿæ•è·æ—¶é—´åºåˆ—ä¸­çš„é¡ºåºå…³ç³»ã€‚
- é€‚åˆçŸ­æ—¶é—´åºåˆ—ä»»åŠ¡ã€‚

**ç¼ºç‚¹ï¼š**

- éš¾ä»¥æ•è·é•¿åºåˆ—ä¸­çš„ä¾èµ–å…³ç³»ã€‚
- è®¡ç®—é€Ÿåº¦æ…¢ï¼Œæ— æ³•å¹¶è¡Œå¤„ç†ã€‚

### 3.2 Transformer ç¤ºä¾‹ä»£ç 

Transformer ä½¿ç”¨è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œèƒ½å¤Ÿå…¨å±€å»ºæ¨¡æ•´ä¸ªåºåˆ—ä¸­çš„å…³ç³»ï¼Œå¹¶è¡Œå¤„ç†æ‰€æœ‰æ—¶é—´æ­¥ï¼Œé€‚åˆé•¿ä¾èµ–åºåˆ—ä»»åŠ¡ã€‚

ä»£ç ç¤ºä¾‹ï¼š
```python
import torch
import torch.nn as nn
from torch.nn import TransformerEncoder, TransformerEncoderLayer

# å®šä¹‰ Transformer æ¨¡å‹
class TransformerModel(nn.Module):
    def __init__(self, input_dim, nhead, hidden_dim, num_layers, output_dim):
        """
        åˆå§‹åŒ– Transformer æ¨¡å‹

        å‚æ•°:
        input_dim (int): è¾“å…¥ç‰¹å¾ç»´åº¦
        nhead (int): å¤šå¤´æ³¨æ„åŠ›å¤´æ•°
        hidden_dim (int): å‰é¦ˆç½‘ç»œçš„éšè—å±‚ç»´åº¦
        num_layers (int): Transformer ç¼–ç å±‚æ•°
        output_dim (int): è¾“å‡ºç»´åº¦
        """
        super(TransformerModel, self).__init__()
        # å®šä¹‰ä¸€ä¸ª Transformer ç¼–ç å±‚
        encoder_layer = TransformerEncoderLayer(d_model=input_dim, nhead=nhead, dim_feedforward=hidden_dim)
        # å°†å¤šä¸ªç¼–ç å±‚å †å æˆ Transformer ç¼–ç å™¨
        self.transformer = TransformerEncoder(encoder_layer, num_layers=num_layers)
        # å®šä¹‰ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼Œå°† Transformer çš„è¾“å‡ºæ˜ å°„åˆ°æœ€ç»ˆçš„è¾“å‡ºç»´åº¦
        self.fc = nn.Linear(input_dim, output_dim)

    def forward(self, x):
        """
        å‰å‘ä¼ æ’­å‡½æ•°

        å‚æ•°:
        x (torch.Tensor): è¾“å…¥å¼ é‡ï¼Œå½¢çŠ¶ä¸º (seq_len, batch_size, input_dim)

        è¿”å›:
        torch.Tensor: è¾“å‡ºå¼ é‡ï¼Œå½¢çŠ¶ä¸º (batch_size, output_dim)
        """
        # é€šè¿‡ Transformer ç¼–ç å™¨å¤„ç†è¾“å…¥
        out = self.transformer(x)  # (seq_len, batch_size, input_dim)
        # å¯¹åºåˆ—ç»´åº¦æ±‚å¹³å‡ï¼Œèšåˆåºåˆ—ä¿¡æ¯
        out = self.fc(out.mean(dim=0))  # (batch_size, input_dim) -> (batch_size, output_dim)
        return out

# æ¨¡å‹å‚æ•°
input_dim = 10  # è¾“å…¥ç‰¹å¾ç»´åº¦
nhead = 2  # å¤šå¤´æ³¨æ„åŠ›å¤´æ•°
hidden_dim = 50  # å‰é¦ˆç½‘ç»œçš„éšè—å±‚ç»´åº¦
num_layers = 2  # Transformer ç¼–ç å±‚æ•°
output_dim = 1  # è¾“å‡ºç»´åº¦

# æ„å»ºæ¨¡å‹
model = TransformerModel(input_dim=input_dim, nhead=nhead, hidden_dim=hidden_dim, num_layers=num_layers, output_dim=output_dim)

# ç¤ºä¾‹è¾“å…¥æ•°æ®ï¼šseq_len=5, batch_size=32
x = torch.randn(5, 32, input_dim)  # æ³¨æ„è¾“å…¥çš„å½¢çŠ¶ (seq_len, batch_size, input_dim)
output = model(x)

print("Transformer è¾“å‡ºç»´åº¦:", output.shape)  # (batch_size, output_dim)
```

**Transformer æ•°æ®æµå›¾è§£ï¼š**

```
è¾“å…¥åºåˆ—ï¼ˆåŒæ—¶è¾“å…¥ï¼‰: x
      â†“
+-----------------------+
|    è‡ªæ³¨æ„åŠ›æœºåˆ¶       |   (å…¨å±€å…³ç³»å»ºæ¨¡)
+-----------------------+
      â†“
+-----------------------+
| å‰é¦ˆç¥ç»ç½‘ç»œ ï¼ˆæ¯å±‚ï¼‰|
+-----------------------+
      â†“
  åºåˆ—è¾“å‡º y
```

**ä¼˜ç‚¹ï¼š**

- å¹¶è¡Œå¤„ç†æ‰€æœ‰æ—¶é—´æ­¥ï¼Œè®­ç»ƒé€Ÿåº¦å¿«ã€‚
- é€‚åˆé•¿ä¾èµ–ä»»åŠ¡ã€‚

**ç¼ºç‚¹ï¼š**

- å¯¹äºè¾ƒçŸ­åºåˆ—å¯èƒ½è¿‡äºå¤æ‚ã€‚

### 3.3 å¯¹æ¯”æ€»ç»“

| ç‰¹æ€§               | RNN                            | Transformer                       |
| ------------------ | ------------------------------ | --------------------------------- |
| æœºåˆ¶               | å¾ªç¯é€æ—¶é—´æ­¥å¤„ç†åºåˆ—           | è‡ªæ³¨æ„åŠ›ï¼Œå»ºæ¨¡å…¨å±€åºåˆ—å…³ç³»        |
| è®­ç»ƒæ•ˆç‡           | é€æ­¥å¤„ç†ï¼Œé€Ÿåº¦æ…¢               | å¹¶è¡Œå¤„ç†ï¼Œé€Ÿåº¦å¿«                  |
| æ•è·é•¿è·ç¦»ä¾èµ–èƒ½åŠ› | è¾ƒå¼±                           | å¾ˆå¼º                              |
| åº”ç”¨åœºæ™¯           | çŸ­æ—¶é—´åºåˆ—å¤„ç†ï¼Œå¦‚æ—¶é—´åºåˆ—é¢„æµ‹ | å¤§å¤šæ•° NLP ä»»åŠ¡ï¼Œä¾‹å¦‚ç¿»è¯‘ã€é—®ç­”ç­‰ |

## 4. æ€»ç»“

é€šè¿‡æœ¬æ–‡ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä»é›¶é…ç½® NLP çš„å¼€å‘ç¯å¢ƒï¼ŒåŒ…æ‹¬å®‰è£… Python å’Œ PyTorch åº“ï¼Œä»¥åŠæ„å»º RNN å’Œ Transformer çš„å…¥é—¨æ¨¡å‹ã€‚

åŸºäºå¯¹ RNN å’Œ Transformer çš„å¯¹æ¯”ï¼Œæ‚¨å¯ä»¥æ ¹æ®ä»»åŠ¡éœ€æ±‚é€‰æ‹©é€‚åˆçš„æ¨¡å‹ï¼Œå¹¶è¿›ä¸€æ­¥æ¢ç´¢ PyTorch æ›´å¤æ‚çš„åŠŸèƒ½å’Œåº”ç”¨ã€‚

ç°åœ¨åŠ¨æ‰‹å®éªŒå§ï¼ğŸ‰
